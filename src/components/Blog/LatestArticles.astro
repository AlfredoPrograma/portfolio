---
import { getCollection } from "astro:content";
import Article from "./Article.astro";
import ButtonLink from "@components/Button/ButtonLink.astro";
import { createLangHref, type Lang } from "@i18n/config";
import type { UIStrings } from "@i18n/dictionaries";

interface LatestArticlesProps {
  lang: Lang;
  copy: UIStrings["latestArticles"];
  dateLocale: string;
}

type Props = LatestArticlesProps;

const { lang, copy, dateLocale } = Astro.props;

const LATEST_ARTICLES_LIMIT = 5;
const articles = await getCollection("articles");

const latestArticles = articles
  .filter((article) => article.data.lang === lang)
  .toSorted((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, LATEST_ARTICLES_LIMIT);
---

<section id="blog" class="py-20 px-6 bg-white">
  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-light text-heading mb-4">
        {copy.title}
      </h2>
      <p class="text-lg text-body max-w-2xl mx-auto leading-relaxed">
        {copy.description}
      </p>
    </div>

    <div class="space-y-8">
      {
        latestArticles.map((article) => (
          <Article
            date={article.data.date}
            excerpt={article.data.excerpt}
            slug={article.data.slug}
            title={article.data.title}
            tags={article.data.tags}
            lang={lang}
            readLabel={copy.readArticle}
            dateLocale={dateLocale}
          />
        ))
      }
    </div>

    <div class="text-center mt-12">
      <ButtonLink href={createLangHref(lang, "/blog")} size="lg">
        {copy.viewAll}
      </ButtonLink>
    </div>
  </div>
</section>
