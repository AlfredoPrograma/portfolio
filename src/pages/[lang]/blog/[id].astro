---
import Layout from "@layouts/Layout.astro";
import Navbar from "@components/Navbar/Navbar.astro";
import Prose from "@components/Blog/Prose.astro";
import Chip from "@components/Chip/Chip.astro";
import { getCollection, render } from "astro:content";
import { type Lang, createLangHref } from "@i18n/config";
import { getDictionary } from "@i18n/dictionaries";

export const prerender = true;

export async function getStaticPaths() {
  const articles = await getCollection("articles");

  return articles.map((article) => ({
    params: { lang: article.data.lang, id: article.data.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const lang = article.data.lang as Lang;
const dictionary = getDictionary(lang);
const { Content } = await render(article);
const pageTitle = `${article.data.title} | ${dictionary.meta.blog} | ${dictionary.meta.brand}`;
---

<Layout lang={lang} title={pageTitle}>
  <Navbar lang={lang} nav={dictionary.nav} />

  <main class="pt-14">
    <div class="py-20 px-6 max-w-4xl mx-auto">
      <header class="mb-4 pb-6 border-b border-neutral-600">
        <a href={createLangHref(lang, "/blog")} class="text-sm mb-2 block underline">
          {dictionary.post.backToBlog}
        </a>

        <h1 class="text-3xl md:text-4xl font-light text-neutral-900 mb-4">
          {article.data.title}
        </h1>
        <p class="text-lg italic text-neutral-600 leading-relaxed mb-4">
          {article.data.excerpt}
        </p>

        <div class="flex flex-wrap gap-2">
          {article.data.tags.map((text) => <Chip>{text}</Chip>)}
        </div>
      </header>

      <Prose>
        <Content />
      </Prose>
    </div>
  </main>
</Layout>
